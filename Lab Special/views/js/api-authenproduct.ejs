<script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        async function authenticateAndFetchProducts() {
            try {
                // üîë ‡∏™‡πà‡∏á email ‡πÅ‡∏•‡∏∞ password ‡πÑ‡∏õ‡∏Ç‡∏≠ Token
                const authResponse = await axios.post("/api/authen", {
                    email: "user1@gmail.com",
                    password: "1234567"
                });

                const token = authResponse.data.token;
                localStorage.setItem("token", token);
                console.log("‚úÖ ‡∏£‡∏±‡∏ö Token ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à:", token);

                // üöÄ ‡πÉ‡∏ä‡πâ Token ‡πÑ‡∏õ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤
                fetchProducts();
            } catch (error) {
                console.error("‚ùå ‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡∏•‡πâ‡∏°‡πÄ‡∏´‡∏•‡∏ß:", error.response?.data?.message || error.message);
            }
        }

        async function fetchProducts(min = null, max = null) {
            try {
                let url = "/api/products";
                if (min !== null && max !== null) {
                    url += `?min=${min}&max=${max}`;
                }

                const token = localStorage.getItem("token");
                if (!token) {
                    console.warn("‚ö†Ô∏è ‡πÑ‡∏°‡πà‡∏°‡∏µ Token, ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Å‡∏£‡∏∞‡∏ö‡∏ß‡∏ô‡∏Å‡∏≤‡∏£‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏ï‡∏±‡∏ß‡∏ï‡∏ô‡πÉ‡∏´‡∏°‡πà");
                    authenticateAndFetchProducts();
                    return;
                }

                const response = await axios.get(url, {
                    headers: { Authorization: token }
                });

                const products = response.data;
                const productList = document.getElementById("product-list");
                productList.innerHTML = "";

                products.forEach(item => {
                    productList.innerHTML += `
                    <div class="col-lg-4 col-md-6 mb-4">
                        <div class="card">
                            <a href="/${item._id}">
                                <img class="card-img-top img-thumbnail" src="./images/products/${item.image}" alt="${item.name}">
                            </a>
                            <div class="card-body">
                                <h5 class="card-title">
                                    <a href="/${item._id}" class="text-dark">${item.name}</a>
                                </h5>
                                <p class="card-text"><strong>‡∏£‡∏≤‡∏Ñ‡∏≤:</strong> ${item.price} THB</p>
                                <p class="card-text">${item.description}</p>
                            </div>
                        </div>
                    </div>`;
                });
            } catch (error) {
                console.error("‚ùå ‡πÑ‡∏°‡πà‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏™‡∏¥‡∏ô‡∏Ñ‡πâ‡∏≤:", error.response?.data?.message || error.message);
            }
        }

        document.getElementById("searchForm").addEventListener("submit", function (event) {
            event.preventDefault();
            const min = document.getElementById("minPrice").value || null;
            const max = document.getElementById("maxPrice").value || null;
            fetchProducts(min, max);
        });

        // üéØ ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô‡πÇ‡∏î‡∏¢‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥
        authenticateAndFetchProducts();
    </script>